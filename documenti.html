<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestione Documenti</title>

  <!-- Tailwind + Inter font -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'ui-sans-serif', 'system-ui'],
          },
        },
      }
    }
  </script>

  <style>
    .nav-link { position: relative; transition: all 0.2s ease; padding-bottom: 3px; color:#334155; font-weight:500; }
    .nav-link::after { content:""; position:absolute; left:0; bottom:0; width:0%; height:2px; background:#0ea5e9; transition:width 0.3s ease; }
    .nav-link:hover::after { width:100%; }
    .nav-link.active { color:#0ea5e9; font-weight:600; }
    .nav-link.active::after { width:100%; }
  </style>
</head>
<body class="bg-slate-100 min-h-screen font-sans">

<!-- NAVBAR -->
<header class="bg-white/80 backdrop-blur-md border-b shadow sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-6 py-3 flex items-center justify-between">
    <!-- Logo e titolo -->
    <a href="index.html" class="flex items-center gap-3">
      <div class="w-50 h-10 rounded-md overflow-hidden shadow-md">
      <img src="images/logo.png" alt="Logo LDP" class="w-full h-full object-cover">
    </div>

      <div>
        <div class="font-semibold text-slate-800 text-lg">ConsulenzaLab</div>
        <div class="text-xs text-slate-500">Legale ¬∑ Fiscale ¬∑ Dati</div>
      </div>
    </a>

    <a href="index.html"
    class="hidden md:inline-flex items-center gap-1 text-sm text-slate-600 font-medium hover:text-slate-800 transition">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M13 5v6h6" />
    </svg>
    Torna alla Home
    

    <!-- Menu principale -->
    <nav class="hidden md:flex items-center gap-6 text-sm font-medium relative">
      <a href="sito_consulenza_completo.html" class="nav-link">Home</a>

      <!-- Dropdown Informatica -->
      <div class="relative group">
        <button class="nav-link flex items-center gap-1">Informatica
          <svg class="w-3 h-3 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>
        <div class="absolute left-0 mt-2 w-40 bg-white shadow-lg rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50">
         
          <a href="powerbi.html" class="block px-4 py-2 hover:bg-slate-100">Dashboard</a>
          <a href="ml.html" class="block px-4 py-2 hover:bg-slate-100">Machine Learning</a>
          <a href="ai-reports.html" class="block px-4 py-2 hover:bg-slate-100">AI Reports</a>
        </div>
      </div>

      <!-- Dropdown Servizi -->
      <div class="relative group">
        <button class="nav-link flex items-center gap-1">Servizi
          <svg class="w-3 h-3 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>
        <div class="absolute left-0 mt-2 w-52 bg-white shadow-lg rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50">
          <a href="legal.html" class="block px-4 py-2 hover:bg-slate-100">Legal</a>
          <a href="tax.html" class="block px-4 py-2 hover:bg-slate-100">Tax</a>
          <a href="payroll.html" class="block px-4 py-2 hover:bg-slate-100">Payroll</a>
          <a href="automation.html" class="block px-4 py-2 hover:bg-slate-100">Automation</a>
          <a href="global.html" class="block px-4 py-2 hover:bg-slate-100">Global</a>
          <a href="corporate-finance.html" class="block px-4 py-2 hover:bg-slate-100">Corporate Finance</a>
          <a href="compliance.html" class="block px-4 py-2 hover:bg-slate-100">Compliance</a>
          <a href="esg.html" class="block px-4 py-2 hover:bg-slate-100">ESG</a>
          <a href="academy.html" class="block px-4 py-2 hover:bg-slate-100">Academy</a>
        </div>
      </div>

      <!-- Link principali -->
      <a href="fatture.html" class="nav-link">Fatture</a>
      <a href="documenti.html" class="nav-link active">Documenti</a>
      <a href="profilo.html" class="nav-link">Profilo</a>
      <a href="help.html" class="nav-link">Help</a>
</header>

<!-- MAIN CONTENT -->
<main class="max-w-6xl mx-auto p-6 space-y-8">
  <!-- UPLOAD -->
  <section class="bg-white shadow rounded-xl p-6">
    <h2 class="text-xl font-bold mb-4">üì§ Carica Documento</h2>
    <input type="file" id="fileUpload" accept=".pdf,.doc,.docx" class="block mb-4">
    <button id="uploadBtn" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Carica</button>
    <p id="errorMsg" class="text-red-600 mt-2 hidden"></p>
  </section>

  <!-- FILTRI -->
  <section class="bg-white shadow rounded-xl p-6 space-y-4">
    <h2 class="text-lg font-semibold">üîé Filtra e Cerca Documenti</h2>
    <div class="flex flex-wrap gap-4">
      <button onclick="setFilter('all')" class="filterBtn bg-slate-200 px-3 py-1 rounded">Tutti</button>
      <button onclick="setFilter('completo')" class="filterBtn bg-slate-200 px-3 py-1 rounded">Completi ‚úÖ</button>
      <button onclick="setFilter('bozza')" class="filterBtn bg-slate-200 px-3 py-1 rounded">Bozze ‚ùå</button>
    </div>
    <input 
      type="text" 
      id="searchInput" 
      placeholder="Cerca per nome documento..." 
      class="mt-2 w-full border border-slate-300 rounded px-3 py-2 text-sm"
    />
  </section>


  <!-- LISTA DOCUMENTI -->
<section class="bg-white shadow rounded-xl p-6">
  <h2 class="text-xl font-bold mb-4">üìÇ Elenco Documenti</h2>

  <div class="overflow-x-auto">
    <table class="min-w-full border border-slate-200 text-sm">
      <thead class="bg-slate-100">
        <tr>
          <th class="px-4 py-2 text-left font-medium text-slate-700">Nome Documento</th>
          <th class="px-4 py-2 text-left font-medium text-slate-700">Data Caricamento</th>
          <th class="px-4 py-2 text-left font-medium text-slate-700">Stato</th>
          <th class="px-4 py-2 text-left font-medium text-slate-700">Azioni</th>
        </tr>
      </thead>
      <tbody id="docsTable" class="divide-y divide-slate-200">
        <!-- Popolato da JS -->
      </tbody>
    </table>
  </div>
</section>
</main>

<footer class="bg-white/80 backdrop-blur-md border-t mt-16 py-6 text-center text-sm text-slate-500">
  &copy; 2025 ConsulenzaLab. Tutti i diritti riservati.
</footer>

<!-- MODALE PDF -->
<div id="docModal" class="fixed inset-0 bg-black/70 flex justify-center items-center hidden">
  <div class="bg-white rounded-lg shadow-lg w-11/12 md:w-3/4 h-3/4 relative">
    <button onclick="closeDoc()" class="absolute top-2 right-2 bg-red-600 text-white px-2 py-1 rounded">‚úñ</button>
    <div class="absolute top-2 left-2 z-50 text-white bg-black/50 px-2 py-1 rounded" id="firmaOverlay"></div>
    <iframe id="docViewer" src="" class="w-full h-full rounded"></iframe>

    <!-- PULSANTE FIRMA -->
    <div class="absolute bottom-4 right-4">
      <button id="firmaBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        ‚úçÔ∏è Firma Documento
      </button>
    </div>
  </div>
</div>




<script>
const uploadBtn = document.getElementById("uploadBtn");
const fileInput = document.getElementById("fileUpload");
const docsTable = document.getElementById("docsTable");
const errorMsg = document.getElementById("errorMsg");
const searchInput = document.getElementById("searchInput");

let filter = "all";
let docs = JSON.parse(localStorage.getItem("documenti")) || [];
renderDocs();

// Funzione per aggiungere documento
function addDocument(file) {
  const validExt = [".pdf", ".doc", ".docx"];
  const ext = file.name.toLowerCase().substring(file.name.lastIndexOf("."));
  if (!validExt.includes(ext)) {
    errorMsg.textContent = "‚ùå Formato non valido! Sono supportati solo PDF, DOC, DOCX.";
    errorMsg.classList.remove("hidden");
    return;
  }

  const reader = new FileReader();
  reader.onload = e => {
    docs.push({
      name: file.name,
      date: new Date().toLocaleDateString(),
      data: e.target.result,
      status: "bozza",
      signedBy: null
    });
    localStorage.setItem("documenti", JSON.stringify(docs));
    renderDocs();
    errorMsg.classList.add("hidden");
    fileInput.value = "";
  };
  reader.readAsDataURL(file);
}

// Upload
uploadBtn.addEventListener("click", () => {
  const file = fileInput.files[0];
  if (!file) {
    errorMsg.textContent = "‚ùå Seleziona prima un file da caricare!";
    errorMsg.classList.remove("hidden");
    return;
  }
  addDocument(file);
});

// Render lista in tabella
function renderDocs() {
  const query = searchInput.value.toLowerCase();
  docsTable.innerHTML = "";
  docs
    .filter(d => filter === "all" || (filter === "completo" && d.status === "completo") || (filter === "bozza" && d.status === "bozza"))
    .filter(d => d.name.toLowerCase().includes(query))
    .forEach((d, i) => {
      const isPdf = d.name.toLowerCase().endsWith(".pdf");
      const btnText = isPdf ? "üëÅÔ∏è Visualizza" : "‚¨áÔ∏è Scarica";
      const btnAction = isPdf ? `openDoc(${i})` : `downloadDoc(${i})`;

      docsTable.innerHTML += `
        <tr class="hover:bg-slate-50">
          <td class="px-4 py-2">${d.name}</td>
          <td class="px-4 py-2">${d.date}</td>
          <td class="px-4 py-2">
            <span class="${d.status === 'completo' ? 'text-green-600' : 'text-red-600'} font-medium">
              ${d.status === 'completo' ? 'Completo ‚úÖ' : 'Bozza ‚ùå'}
            </span>
          </td>
          <td class="px-4 py-2 space-x-2">
            <button onclick="${btnAction}" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">${btnText}</button>
            ${d.status === 'bozza' ? `<button onclick="signDoc(${i})" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">‚úçÔ∏è Completa</button>` : ""}
            <button onclick="deleteDoc(${i})" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700">üóëÔ∏è Elimina</button>
          </td>
        </tr>
      `;
    });
}

// Ricerca dinamica
searchInput.addEventListener("input", renderDocs);

// Apri documento PDF
let currentDocIndex = null; // tiene traccia del documento aperto

function openDoc(index) {
  currentDocIndex = index;
  const d = docs[index];
  const viewer = document.getElementById("docViewer");
  const overlay = document.getElementById("firmaOverlay");
  viewer.src = d.data;
  overlay.textContent = d.signedBy ? `Firma digitale: ${d.signedBy}` : "";
  document.getElementById("docModal").classList.remove("hidden");
}

document.getElementById("firmaBtn").addEventListener("click", () => {
  if (currentDocIndex !== null) {
    signDoc(currentDocIndex);         // firma documento
    document.getElementById("firmaOverlay").textContent = `Firma digitale: ${docs[currentDocIndex].signedBy}`;
    alert("‚úÖ Documento firmato con successo!");
    closeDoc();
  }
});

function closeDoc() {
  document.getElementById("docViewer").src = "";
  document.getElementById("firmaOverlay").textContent = "";
  document.getElementById("docModal").classList.add("hidden");
}


// Firma/completa documento
function signDoc(index) {
  const user = JSON.parse(localStorage.getItem("profilo")) || {};
  const nomeCompleto = user.nome ? `${user.nome} ${user.cognome || ""}` : "Utente Sconosciuto";
  docs[index].status = "completo";
  docs[index].signedBy = nomeCompleto;
  localStorage.setItem("documenti", JSON.stringify(docs));
  renderDocs();
}

// Elimina documento
function deleteDoc(index) {
  if(confirm("Sei sicuro di voler eliminare questo documento?")) {
    docs.splice(index,1);
    localStorage.setItem("documenti", JSON.stringify(docs));
    renderDocs();
  }
}

// Filtri
function setFilter(type) {
  filter = type;
  renderDocs();
  document.querySelectorAll(".filterBtn").forEach(btn => btn.classList.remove("bg-blue-300"));
  event.target.classList.add("bg-blue-300");
}
</script>
</body>
</html>
